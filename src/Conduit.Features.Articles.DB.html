<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuasiQuotes, TemplateHaskell, UndecidableInstances, AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Conduit.Features.Articles.DB</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#migrateArticleTables"><span class="hs-identifier">migrateArticleTables</span></a></span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#createArticleFunctions"><span class="hs-identifier">createArticleFunctions</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#assumingUserIsOwner"><span class="hs-identifier">assumingUserIsOwner</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#mkManyArticles"><span class="hs-identifier">mkManyArticles</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#mkOneArticle"><span class="hs-identifier">mkOneArticle</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#Article"><span class="hs-identifier">Article</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#Favorite"><span class="hs-identifier">Favorite</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#Comment"><span class="hs-identifier">Comment</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Conduit.DB.Core.html"><span class="hs-identifier">Conduit.DB.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Conduit.DB.Core.html#SqlKey"><span class="hs-identifier">SqlKey</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.DB.Core.html#authorizationSqlError"><span class="hs-identifier">authorizationSqlError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.DB.Core.html#deriveSqlKey"><span class="hs-identifier">deriveSqlKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.DB.Core.html#resourceNotFoundSqlError"><span class="hs-identifier">resourceNotFoundSqlError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Conduit.DB.Utils.html"><span class="hs-identifier">Conduit.DB.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Conduit.DB.Utils.html#suchThat"><span class="hs-identifier">suchThat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Conduit.Features.Account.DB.html"><span class="hs-identifier">Conduit.Features.Account.DB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Conduit.Features.Account.DB.html#User"><span class="hs-identifier">User</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Account.DB.html#UserId"><span class="hs-identifier">UserId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Account.DB.html#mkProfile"><span class="hs-identifier">mkProfile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Conduit.Features.Account.Types.html"><span class="hs-identifier">Conduit.Features.Account.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Conduit.Features.Account.Types.html#UserID"><span class="hs-identifier">UserID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.Types.html"><span class="hs-identifier">Conduit.Features.Articles.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Conduit.Features.Articles.Types.html#ArticleID"><span class="hs-identifier">ArticleID</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.Types.html#CommentID"><span class="hs-identifier">CommentID</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.Types.html#ManyArticles"><span class="hs-identifier">ManyArticles</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.Types.html#OneArticle"><span class="hs-identifier">OneArticle</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.Types.html#Slug"><span class="hs-identifier">Slug</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.FileEmbed</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">embedFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.Esqueleto.Experimental</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Entity</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PersistEntity</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SqlExpr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SqlPersistT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">from</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">rawExecute</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">selectOne</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">table</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">val</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(==.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.Persist.TH</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkMigrate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkPersist</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">persistLowerCase</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">share</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sqlSettings</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span id="Article"><span id="Favorite"><span id="Comment"><span id="Key"><span id="PersistEntityBackend"><span id="EntityField"><span id="Unique"><span id="local-6989586621679280000"><span id="local-6989586621679280001"><span id="local-6989586621679280002"><span id="migrateArticleTables"><span id="local-6989586621679280148"><span id="local-6989586621679280154"><span id="local-6989586621679280158"><span id="local-6989586621679280161"><span id="local-6989586621679280165"><span id="local-6989586621679280168"><span id="local-6989586621679280178"><span id="local-6989586621679280181"><span id="local-6989586621679280186"><span id="local-6989586621679280193"><span id="local-6989586621679280198"><span id="local-6989586621679280202"><span id="local-6989586621679280206"><span id="local-6989586621679280210"><span id="local-6989586621679280214"><span id="local-6989586621679280218"><span id="local-6989586621679280222"><span id="local-6989586621679280227"><span id="local-6989586621679280231"><span id="local-6989586621679280236"><span id="local-6989586621679280240"><span id="local-6989586621679280244"><span id="local-6989586621679280248"><span id="local-6989586621679280252"><span id="local-6989586621679280257"><span id="local-6989586621679280261"><span id="local-6989586621679280265"><span id="local-6989586621679280270"><span id="local-6989586621679280277"><span id="local-6989586621679280282"><span id="local-6989586621679280287"><span id="local-6989586621679280291"><span id="local-6989586621679280295"><span id="local-6989586621679280299"><span id="local-6989586621679280303"><span id="local-6989586621679280308"><span id="local-6989586621679280312"><span id="local-6989586621679280316"><span id="local-6989586621679280323"><span id="local-6989586621679280327"><span id="local-6989586621679280330"><span id="local-6989586621679280334"><span id="local-6989586621679280337"><span id="local-6989586621679280350"><span id="local-6989586621679280353"><span id="local-6989586621679280359"><span id="local-6989586621679280365"><span id="local-6989586621679280371"><span id="local-6989586621679280375"><span id="local-6989586621679280379"><span id="local-6989586621679280382"><span id="local-6989586621679280385"><span id="local-6989586621679280388"><span id="local-6989586621679280391"><span id="local-6989586621679280393"><span id="local-6989586621679280395"><span id="local-6989586621679280399"><span id="local-6989586621679280402"><span id="local-6989586621679280405"><span id="local-6989586621679280408"><span id="local-6989586621679280411"><span id="local-6989586621679280419"><span id="local-6989586621679280422"><span id="local-6989586621679280426"><span id="local-6989586621679280432"><span id="local-6989586621679280436"><span id="local-6989586621679280440"><span id="local-6989586621679280444"><span id="local-6989586621679280448"><span id="local-6989586621679280452"><span id="local-6989586621679280456"><span id="local-6989586621679280460"><span id="local-6989586621679280464"><span id="local-6989586621679280468"><span id="local-6989586621679280472"><span id="local-6989586621679280476"><span id="local-6989586621679280480"><span id="local-6989586621679280484"><span id="local-6989586621679280488"><span id="local-6989586621679280492"><span id="local-6989586621679280496"><span id="local-6989586621679280500"><span id="local-6989586621679280504"><span id="local-6989586621679280511"><span id="local-6989586621679280515"><span id="local-6989586621679280519"><span id="local-6989586621679280523"><span id="local-6989586621679280527"><span id="local-6989586621679280531"><span id="local-6989586621679280535"><span id="local-6989586621679280539"><span id="local-6989586621679280543"><span id="local-6989586621679280564"><span id="local-6989586621679280567"><span id="local-6989586621679280572"><span id="local-6989586621679280575"><span id="local-6989586621679280586"><span id="local-6989586621679280588"><span id="local-6989586621679280598"><span id="local-6989586621679280616"><span id="local-6989586621679280634"><span id="local-6989586621679280636"><span id="local-6989586621679280640"><span id="local-6989586621679280644"><span id="local-6989586621679280647"><span id="local-6989586621679280649"><span id="local-6989586621679280652"><span id="local-6989586621679280655"><span id="local-6989586621679280658"><span id="local-6989586621679280661"><span id="local-6989586621679280664"><span id="local-6989586621679280670"><span id="local-6989586621679280677"><span id="local-6989586621679280689"><span id="local-6989586621679280691"><span id="local-6989586621679280696"><span id="local-6989586621679280698"><span id="local-6989586621679280701"><span id="local-6989586621679280721"><span id="local-6989586621679280725"><span id="local-6989586621679280734"><span id="local-6989586621679280737"><span id="local-6989586621679280745"><span id="local-6989586621679280747"><span id="local-6989586621679280751"><span id="local-6989586621679280760"><span id="local-6989586621679280772"><span id="local-6989586621679280774"><span id="local-6989586621679280776"><span id="local-6989586621679280780"><span id="local-6989586621679280783"><span id="local-6989586621679280785"><span id="local-6989586621679280788"><span id="local-6989586621679280791"><span id="local-6989586621679280796"><span id="local-6989586621679280803"><span id="local-6989586621679280808"><span id="local-6989586621679280815"><span id="local-6989586621679280818"><span id="local-6989586621679280821"><span id="local-6989586621679280827"><span id="local-6989586621679280830"><span id="local-6989586621679280833"><span id="local-6989586621679280836"><span id="local-6989586621679280841"><span id="local-6989586621679280843"><span id="local-6989586621679280846"><span id="local-6989586621679280861"><span id="local-6989586621679280863"><span id="local-6989586621679280866"><span id="local-6989586621679280885"><span id="local-6989586621679280888"><span id="local-6989586621679280892"><span id="local-6989586621679280895"><span id="local-6989586621679280904"><span id="local-6989586621679280906"><span id="local-6989586621679280917"><span id="local-6989586621679280938"><span id="local-6989586621679280962"><span id="local-6989586621679280964"><span id="local-6989586621679280966"><span id="local-6989586621679280970"><span id="local-6989586621679280973"><span id="local-6989586621679280975"><span id="local-6989586621679280978"><span id="local-6989586621679280981"><span id="local-6989586621679280984"><span id="local-6989586621679280987"><span id="local-6989586621679280990"><span id="local-6989586621679280993"><span id="local-6989586621679280996"><span id="local-6989586621679280999"><span id="local-6989586621679281004"><span id="local-6989586621679281012"><span id="local-6989586621679281023"><span id="local-6989586621679281025"><span id="local-6989586621679281030"><span id="local-6989586621679281032"><span id="local-6989586621679281035"><span id="CommentId"><span id="Comment"><span id="%24sel%3AcommentAuthor%3AComment"><span id="%24sel%3AcommentArticle%3AComment"><span id="%24sel%3AcommentBody%3AComment"><span id="%24sel%3AcommentCreated%3AComment"><span id="%24sel%3AcommentUpdated%3AComment"><span id="FavoriteId"><span id="Favorite"><span id="%24sel%3AfavoriteUser%3AFavorite"><span id="%24sel%3AfavoriteArticle%3AFavorite"><span id="ArticleId"><span id="Article"><span id="%24sel%3AarticleAuthor%3AArticle"><span id="%24sel%3AarticleSlug%3AArticle"><span id="%24sel%3AarticleTitle%3AArticle"><span id="%24sel%3AarticleDesc%3AArticle"><span id="%24sel%3AarticleBody%3AArticle"><span id="%24sel%3AarticleTags%3AArticle"><span id="%24sel%3AarticleCreated%3AArticle"><span id="%24sel%3AarticleUpdated%3AArticle"><span id="CommentKey"><span id="%24sel%3AunCommentKey%3ACommentKey"><span id="CommentId"><span id="CommentAuthor"><span id="CommentArticle"><span id="CommentBody"><span id="CommentCreated"><span id="CommentUpdated"><span id="FavoritePrimaryKey"><span id="FavoriteKey"><span id="%24sel%3AfavoriteKeyarticle%3AFavoriteKey"><span id="%24sel%3AfavoriteKeyuser%3AFavoriteKey"><span id="FavoriteId"><span id="FavoriteUser"><span id="FavoriteArticle"><span id="UniqueSlug"><span id="UniqueTitle"><span id="ArticleKey"><span id="%24sel%3AunArticleKey%3AArticleKey"><span id="ArticleId"><span id="ArticleAuthor"><span id="ArticleSlug"><span id="ArticleTitle"><span id="ArticleDesc"><span id="ArticleBody"><span id="ArticleTags"><span id="ArticleCreated"><span id="ArticleUpdated"><span id="entityDefListFormigrateArticleTables"><span class="hs-identifier">share</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">mkPersist</span><span> </span><span class="hs-identifier">sqlSettings</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkMigrate</span><span> </span><span class="hs-string">&quot;migrateArticleTables&quot;</span><span class="hs-special">]</span><span> </span><span class="">[persistLowerCase|
  Article
    author  UserId  OnDeleteCascade
    slug     Text
    title    Text
    desc     Text
    body     Text
    tags    [Text]
    created UTCTime default=now()
    updated UTCTime default=now()
    UniqueSlug   slug
    UniqueTitle title

  Favorite
    user    UserId    OnDeleteCascade
    article ArticleId OnDeleteCascade
    Primary article user

  Comment
    author  UserId    OnDeleteCascade
    article ArticleId OnDeleteCascade
    body    Text
    created UTCTime default=now()
    updated UTCTime default=now()
|]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span id="local-6989586621679280038"><span class="annot"><a href="Conduit.Features.Articles.DB.html#createArticleFunctions"><span class="hs-identifier hs-type">createArticleFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679280038"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlPersistT</span></span><span> </span><span class="annot"><a href="#local-6989586621679280038"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-53"></span><span id="createArticleFunctions"><span class="annot"><span class="annottext">createArticleFunctions :: forall (m :: * -&gt; *). MonadIO m =&gt; SqlPersistT m ()
</span><a href="Conduit.Features.Articles.DB.html#createArticleFunctions"><span class="hs-identifier hs-var hs-var">createArticleFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [PersistValue] -&gt; ReaderT SqlBackend m ()
forall (m :: * -&gt; *) backend.
(MonadIO m, BackendCompatible SqlBackend backend) =&gt;
Text -&gt; [PersistValue] -&gt; ReaderT backend m ()
</span><span class="hs-identifier hs-var">rawExecute</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679281667"><span class="hs-identifier hs-var">fns</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621679281667"><span class="annot"><span class="annottext">fns :: Text
</span><a href="#local-6989586621679281667"><span class="hs-identifier hs-var hs-var">fns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
forall a b. ConvertUtf8 a b =&gt; b -&gt; a
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">embedFile</span><span> </span><span class="hs-string">&quot;sqlbits/articles/slug_id_prepender.sql&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">embedFile</span><span> </span><span class="hs-string">&quot;sqlbits/articles/set_timestamps.sql&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-special">$</span><span id="local-6989586621679281679"><span id="local-6989586621679281682"><span class="hs-special">(</span><span class="hs-identifier">deriveSqlKey</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Article</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ArticleID</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-60"></span><span class="hs-special">$</span><span id="local-6989586621679281693"><span id="local-6989586621679281696"><span class="hs-special">(</span><span class="hs-identifier">deriveSqlKey</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Comment</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">CommentID</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Conduit.Features.Articles.DB.html#assumingUserIsOwner"><span class="hs-identifier hs-type">assumingUserIsOwner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">&#8704;</span><span> </span><span id="local-6989586621679280059"><span class="annot"><a href="#local-6989586621679280059"><span class="hs-identifier hs-type">table</span></a></span></span><span> </span><span id="local-6989586621679280061"><span class="annot"><a href="#local-6989586621679280061"><span class="hs-identifier hs-type">id</span></a></span></span><span> </span><span id="local-6989586621679280062"><span class="annot"><a href="#local-6989586621679280062"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679280065"><span class="annot"><a href="#local-6989586621679280065"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679280063"><span class="annot"><a href="#local-6989586621679280063"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Conduit.Features.Articles.DB.html#OwnableEntity"><span class="hs-identifier hs-type">OwnableEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679280059"><span class="hs-identifier hs-type">table</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Conduit.DB.Core.html#SqlKey"><span class="hs-identifier hs-type">SqlKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679280059"><span class="hs-identifier hs-type">table</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679280061"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679280062"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679280063"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679280063"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Conduit.Features.Account.Types.html#UserID"><span class="hs-identifier hs-type">UserID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679280061"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlPersistT</span></span><span> </span><span class="annot"><a href="#local-6989586621679280062"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679280065"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlPersistT</span></span><span> </span><span class="annot"><a href="#local-6989586621679280062"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679280065"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-63"></span><span id="assumingUserIsOwner"><span class="annot"><span class="annottext">assumingUserIsOwner :: forall table id (m :: * -&gt; *) a e.
(OwnableEntity table, SqlKey table id, MonadIO m, Show e) =&gt;
e -&gt; UserID -&gt; id -&gt; SqlPersistT m a -&gt; SqlPersistT m a
</span><a href="Conduit.Features.Articles.DB.html#assumingUserIsOwner"><span class="hs-identifier hs-var hs-var">assumingUserIsOwner</span></a></span></span><span> </span><span id="local-6989586621679281742"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679281742"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679281743"><span class="annot"><span class="annottext">UserID
</span><a href="#local-6989586621679281743"><span class="hs-identifier hs-var">userID</span></a></span></span><span> </span><span id="local-6989586621679281744"><span class="annot"><span class="annottext">id
</span><a href="#local-6989586621679281744"><span class="hs-identifier hs-var">tableID</span></a></span></span><span> </span><span id="local-6989586621679281745"><span class="annot"><span class="annottext">SqlPersistT m a
</span><a href="#local-6989586621679281745"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>  </span><span id="local-6989586621679281746"><span class="annot"><span class="annottext">Maybe (Entity table)
</span><a href="#local-6989586621679281746"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SqlQuery (SqlExpr (Entity table))
-&gt; ReaderT SqlBackend m (Maybe (Entity table))
forall a r (m :: * -&gt; *) backend.
(SqlSelect a r, MonadIO m, SqlBackendCanRead backend) =&gt;
SqlQuery a -&gt; ReaderT backend m (Maybe r)
</span><span class="hs-identifier hs-var">selectOne</span></span><span> </span><span class="annot"><span class="annottext">(SqlQuery (SqlExpr (Entity table))
 -&gt; ReaderT SqlBackend m (Maybe (Entity table)))
-&gt; SqlQuery (SqlExpr (Entity table))
-&gt; ReaderT SqlBackend m (Maybe (Entity table))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">From (SqlExpr (Entity table)) -&gt; SqlQuery (SqlExpr (Entity table))
forall a a'. ToFrom a a' =&gt; a -&gt; SqlQuery a'
</span><span class="hs-identifier hs-var">from</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ent. PersistEntity ent =&gt; From (SqlExpr (Entity ent))
</span><span class="hs-identifier hs-var">table</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679280059"><span class="hs-identifier hs-type">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">SqlQuery (SqlExpr (Entity table))
-&gt; (SqlExpr (Entity table) -&gt; SqlExpr (Value Bool))
-&gt; SqlQuery (SqlExpr (Entity table))
forall a. SqlQuery a -&gt; (a -&gt; SqlExpr (Value Bool)) -&gt; SqlQuery a
</span><a href="Conduit.DB.Utils.html#suchThat"><span class="hs-operator hs-var">`suchThat`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679281747"><span class="annot"><span class="annottext">SqlExpr (Entity table)
</span><a href="#local-6989586621679281747"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>      </span><span class="annot"><span class="annottext">SqlExpr (Entity table) -&gt; SqlExpr (Value (Key table))
forall table.
OwnableEntity table =&gt;
SqlExpr (Entity table) -&gt; SqlExpr (Value (Key table))
</span><a href="Conduit.Features.Articles.DB.html#getID"><span class="hs-identifier hs-var">getID</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Entity table)
</span><a href="#local-6989586621679281747"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value (Key table))
-&gt; SqlExpr (Value (Key table)) -&gt; SqlExpr (Value Bool)
forall typ.
PersistField typ =&gt;
SqlExpr (Value typ) -&gt; SqlExpr (Value typ) -&gt; SqlExpr (Value Bool)
</span><span class="hs-operator hs-var">==.</span></span><span> </span><span class="annot"><span class="annottext">Key table -&gt; SqlExpr (Value (Key table))
forall typ. PersistField typ =&gt; typ -&gt; SqlExpr (Value typ)
</span><span class="hs-identifier hs-var">val</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">id -&gt; Key table
forall t id. SqlKey t id =&gt; id -&gt; Key t
</span><a href="Conduit.DB.Core.html#id2sqlKey"><span class="hs-identifier hs-var">id2sqlKey</span></a></span><span> </span><span class="annot"><span class="annottext">id
</span><a href="#local-6989586621679281744"><span class="hs-identifier hs-var">tableID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Entity table)
</span><a href="#local-6989586621679281746"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Entity table)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SqlError -&gt; SqlPersistT m a
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">SqlError
</span><a href="Conduit.DB.Core.html#resourceNotFoundSqlError"><span class="hs-identifier hs-var">resourceNotFoundSqlError</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679281749"><span class="annot"><span class="annottext">Entity table
</span><a href="#local-6989586621679281749"><span class="hs-identifier hs-var">resource</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Entity table -&gt; UserID
forall table. OwnableEntity table =&gt; Entity table -&gt; UserID
</span><a href="Conduit.Features.Articles.DB.html#getOwner"><span class="hs-identifier hs-var">getOwner</span></a></span><span> </span><span class="annot"><span class="annottext">Entity table
</span><a href="#local-6989586621679281749"><span class="hs-identifier hs-var">resource</span></a></span><span> </span><span class="annot"><span class="annottext">UserID -&gt; UserID -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UserID
</span><a href="#local-6989586621679281743"><span class="hs-identifier hs-var">userID</span></a></span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SqlPersistT m a
</span><a href="#local-6989586621679281745"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-72"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SqlError -&gt; SqlPersistT m a
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(SqlError -&gt; SqlPersistT m a) -&gt; SqlError -&gt; SqlPersistT m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">e -&gt; SqlError
forall e. Show e =&gt; e -&gt; SqlError
</span><a href="Conduit.DB.Core.html#authorizationSqlError"><span class="hs-identifier hs-var">authorizationSqlError</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679281742"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PersistEntity</span></span><span> </span><span class="annot"><a href="#local-6989586621679280086"><span class="hs-identifier hs-type">table</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="OwnableEntity"><span class="annot"><a href="Conduit.Features.Articles.DB.html#OwnableEntity"><span class="hs-identifier hs-var">OwnableEntity</span></a></span></span><span> </span><span id="local-6989586621679280086"><span class="annot"><a href="#local-6989586621679280086"><span class="hs-identifier hs-type">table</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-75"></span><span>  </span><span id="getID"><span class="annot"><a href="Conduit.Features.Articles.DB.html#getID"><span class="hs-identifier hs-type">getID</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlExpr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679280086"><span class="hs-identifier hs-type">table</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlExpr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Key</span></span><span> </span><span class="annot"><a href="#local-6989586621679280086"><span class="hs-identifier hs-type">table</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>  </span><span id="getOwner"><span class="annot"><a href="Conduit.Features.Articles.DB.html#getOwner"><span class="hs-identifier hs-type">getOwner</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679280086"><span class="hs-identifier hs-type">table</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Conduit.Features.Account.Types.html#UserID"><span class="hs-identifier hs-type">UserID</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#OwnableEntity"><span class="hs-identifier hs-type">OwnableEntity</span></a></span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#Article"><span class="hs-identifier hs-type">Article</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621679281760"><span class="annot"><span class="annottext">getOwner :: Entity Article -&gt; UserID
</span><a href="Conduit.Features.Articles.DB.html#getOwner"><span class="hs-identifier hs-var hs-var hs-var hs-var">getOwner</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><span class="annottext">Key Article
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679281761"><span class="annot"><span class="annottext">Article
</span><a href="#local-6989586621679281761"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserId -&gt; UserID
forall t id. SqlKey t id =&gt; Key t -&gt; id
</span><a href="Conduit.DB.Core.html#sqlKey2ID"><span class="hs-identifier hs-var">sqlKey2ID</span></a></span><span> </span><span class="annot"><span class="annottext">Article
</span><a href="#local-6989586621679281761"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">articleAuthor</span><span>
</span><span id="line-80"></span><span>  </span><span id="local-6989586621679281767"><span class="annot"><span class="annottext">getID :: SqlExpr (Entity Article) -&gt; SqlExpr (Value (Key Article))
</span><a href="Conduit.Features.Articles.DB.html#getID"><span class="hs-identifier hs-var hs-var hs-var hs-var">getID</span></a></span></span><span> </span><span id="local-6989586621679281768"><span class="annot"><span class="annottext">SqlExpr (Entity Article)
</span><a href="#local-6989586621679281768"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlExpr (Entity Article)
</span><a href="#local-6989586621679281768"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">id</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#OwnableEntity"><span class="hs-identifier hs-type">OwnableEntity</span></a></span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#Comment"><span class="hs-identifier hs-type">Comment</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>  </span><span id="local-6989586621679281776"><span class="annot"><span class="annottext">getOwner :: Entity Comment -&gt; UserID
</span><a href="Conduit.Features.Articles.DB.html#getOwner"><span class="hs-identifier hs-var hs-var hs-var hs-var">getOwner</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><span class="annottext">Key Comment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679281777"><span class="annot"><span class="annottext">Comment
</span><a href="#local-6989586621679281777"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserId -&gt; UserID
forall t id. SqlKey t id =&gt; Key t -&gt; id
</span><a href="Conduit.DB.Core.html#sqlKey2ID"><span class="hs-identifier hs-var">sqlKey2ID</span></a></span><span> </span><span class="annot"><span class="annottext">Comment
</span><a href="#local-6989586621679281777"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">commentAuthor</span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621679281782"><span class="annot"><span class="annottext">getID :: SqlExpr (Entity Comment) -&gt; SqlExpr (Value (Key Comment))
</span><a href="Conduit.Features.Articles.DB.html#getID"><span class="hs-identifier hs-var hs-var hs-var hs-var">getID</span></a></span></span><span> </span><span id="local-6989586621679281783"><span class="annot"><span class="annottext">SqlExpr (Entity Comment)
</span><a href="#local-6989586621679281783"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlExpr (Entity Comment)
</span><a href="#local-6989586621679281783"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">id</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="annot"><a href="Conduit.Features.Articles.DB.html#mkManyArticles"><span class="hs-identifier hs-type">mkManyArticles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#Article"><span class="hs-identifier hs-type">Article</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="Conduit.Features.Account.DB.html#User"><span class="hs-identifier hs-type">User</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.Types.html#ManyArticles"><span class="hs-identifier hs-type">ManyArticles</span></a></span><span>
</span><span id="line-87"></span><span id="mkManyArticles"><span class="annot"><span class="annottext">mkManyArticles :: [(Entity Article, Entity User, Value Bool, Value Bool, Value Int)]
-&gt; ManyArticles
</span><a href="Conduit.Features.Articles.DB.html#mkManyArticles"><span class="hs-identifier hs-var hs-var">mkManyArticles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OneArticle] -&gt; ManyArticles
</span><a href="Conduit.Features.Articles.Types.html#ManyArticles"><span class="hs-identifier hs-var">ManyArticles</span></a></span><span> </span><span class="annot"><span class="annottext">([OneArticle] -&gt; ManyArticles)
-&gt; ([(Entity Article, Entity User, Value Bool, Value Bool,
      Value Int)]
    -&gt; [OneArticle])
-&gt; [(Entity Article, Entity User, Value Bool, Value Bool,
     Value Int)]
-&gt; ManyArticles
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Entity Article, Entity User, Value Bool, Value Bool, Value Int)
 -&gt; OneArticle)
-&gt; [(Entity Article, Entity User, Value Bool, Value Bool,
     Value Int)]
-&gt; [OneArticle]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Entity Article, Entity User, Value Bool, Value Bool, Value Int)
-&gt; OneArticle
</span><a href="Conduit.Features.Articles.DB.html#mkOneArticle"><span class="hs-identifier hs-var">mkOneArticle</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><a href="Conduit.Features.Articles.DB.html#mkOneArticle"><span class="hs-identifier hs-type">mkOneArticle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#Article"><span class="hs-identifier hs-type">Article</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="Conduit.Features.Account.DB.html#User"><span class="hs-identifier hs-type">User</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.Types.html#OneArticle"><span class="hs-identifier hs-type">OneArticle</span></a></span><span>
</span><span id="line-90"></span><span id="mkOneArticle"><span class="annot"><span class="annottext">mkOneArticle :: (Entity Article, Entity User, Value Bool, Value Bool, Value Int)
-&gt; OneArticle
</span><a href="Conduit.Features.Articles.DB.html#mkOneArticle"><span class="hs-identifier hs-var hs-var">mkOneArticle</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><span class="annottext">Key Article
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Conduit.Features.Articles.DB.html#Article"><span class="hs-identifier hs-type">Article</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679281785"><span id="local-6989586621679281786"><span id="local-6989586621679281787"><span id="local-6989586621679281788"><span id="local-6989586621679281789"><span id="local-6989586621679281790"><span id="local-6989586621679281791"><span id="local-6989586621679281792"><span class="annot"><span class="annottext">[Text]
Text
UTCTime
UserId
$sel:articleAuthor:Article :: Article -&gt; UserId
$sel:articleSlug:Article :: Article -&gt; Text
$sel:articleTitle:Article :: Article -&gt; Text
$sel:articleDesc:Article :: Article -&gt; Text
$sel:articleBody:Article :: Article -&gt; Text
$sel:articleTags:Article :: Article -&gt; [Text]
$sel:articleCreated:Article :: Article -&gt; UTCTime
$sel:articleUpdated:Article :: Article -&gt; UTCTime
articleAuthor :: UserId
articleSlug :: Text
articleTitle :: Text
articleDesc :: Text
articleBody :: Text
articleTags :: [Text]
articleCreated :: UTCTime
articleUpdated :: UTCTime
</span><a href="Conduit.Features.Articles.DB.html#%24sel%3AarticleAuthor%3AArticle"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679281793"><span class="annot"><span class="annottext">Entity User
</span><a href="#local-6989586621679281793"><span class="hs-identifier hs-var">user</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679281794"><span class="annot"><span class="annottext">Value Bool
</span><a href="#local-6989586621679281794"><span class="hs-identifier hs-var">follows</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span id="local-6989586621679281796"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679281796"><span class="hs-identifier hs-var">faved</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span id="local-6989586621679281797"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679281797"><span class="hs-identifier hs-var">numFavs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Conduit.Features.Articles.Types.html#OneArticle"><span class="hs-identifier hs-type">OneArticle</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:slug:OneArticle :: Slug
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Aslug%3AOneArticle"><span class="hs-identifier hs-var">slug</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679281786"><span class="hs-identifier hs-var">articleSlug</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Slug) -&gt; Slug
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Slug
</span><a href="Conduit.Features.Articles.Types.html#Slug"><span class="hs-identifier hs-var">Slug</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:title:OneArticle :: Text
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Atitle%3AOneArticle"><span class="hs-identifier hs-var">title</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679281787"><span class="hs-identifier hs-var">articleTitle</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:tags:OneArticle :: [Text]
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Atags%3AOneArticle"><span class="hs-identifier hs-var">tags</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679281790"><span class="hs-identifier hs-var">articleTags</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; ([Text] -&gt; [Text]) -&gt; [Text]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:body:OneArticle :: Text
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Abody%3AOneArticle"><span class="hs-identifier hs-var">body</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679281789"><span class="hs-identifier hs-var">articleBody</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:created:OneArticle :: UTCTime
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Acreated%3AOneArticle"><span class="hs-identifier hs-var">created</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679281791"><span class="hs-identifier hs-var">articleCreated</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:updated:OneArticle :: UTCTime
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Aupdated%3AOneArticle"><span class="hs-identifier hs-var">updated</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679281792"><span class="hs-identifier hs-var">articleUpdated</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:favorited:OneArticle :: Bool
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Afavorited%3AOneArticle"><span class="hs-identifier hs-var">favorited</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679281796"><span class="hs-identifier hs-var">faved</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:numFavs:OneArticle :: Int
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3AnumFavs%3AOneArticle"><span class="hs-identifier hs-var">numFavs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679281797"><span class="hs-identifier hs-var">numFavs</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:desc:OneArticle :: Text
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Adesc%3AOneArticle"><span class="hs-identifier hs-var">desc</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679281788"><span class="hs-identifier hs-var">articleDesc</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:author:OneArticle :: UserProfile
</span><a href="Conduit.Features.Articles.Types.html#%24sel%3Aauthor%3AOneArticle"><span class="hs-identifier hs-var">author</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Entity User -&gt; Value Bool -&gt; UserProfile
</span><a href="Conduit.Features.Account.DB.html#mkProfile"><span class="hs-identifier hs-var">mkProfile</span></a></span><span> </span><span class="annot"><span class="annottext">Entity User
</span><a href="#local-6989586621679281793"><span class="hs-identifier hs-var">user</span></a></span><span> </span><span class="annot"><span class="annottext">Value Bool
</span><a href="#local-6989586621679281794"><span class="hs-identifier hs-var">follows</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-102"></span></pre></body></html>